import React, {Component} from 'react'
import {connect} from 'react-redux'
import {
    fetchUsers,createUser
} from 'actions'

class Dashboard extends Component {
    constructor (props) {
        super(props)
        this.state = {
            userName: ''
        };
        this.handleChange = this.handleChange.bind(this)
        this.onUserCreate = this.onUserCreate.bind(this)
    }


    componentDidMount () {
        this.props.fetchUsers();
    }
    handleChange(event) {
        this.setState({
            userName: event.target.value
        });
    }
    onUserCreate(){
        console.log(this.state.userName);
        this.props.createUser(this.state.userName);
        this.props.fetchUsers();
        this.state = {
            userName: ''
        };
    }
    render () {
        let listItems = [];
        if(this.props.state.users.length  > 0){
            listItems = this.props.state.users.map((user) =>
                <li key={user._id}>
                    <span> id - {user._id}</span>
                    <span> role - {user.role}</span>
                </li>
            );
        }
        return (
            <main className='dashboard-page'>
                <h1>User - {this.state.userName || 'none'}</h1>
                <input className="input" type='text' value={this.state.userName} onChange={this.handleChange} />
                <button onClick={this.onUserCreate} className="btn">Create new user</button>
                <ul>
                    {listItems}
                </ul>
            </main>

        )
    }
}

const mapStateToProps = (state, ownProps) => {
    return {
        state: state,
        ownProps: ownProps
    }
};

const mapDispatchToProps = {
    fetchUsers,
    createUser

};

export default connect(mapStateToProps, mapDispatchToProps)(Dashboard)