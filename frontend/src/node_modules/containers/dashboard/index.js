import React, {Component} from 'react'
import {connect} from 'react-redux'
import {
    fetchUsers,createUser,login
} from 'actions'

class Dashboard extends Component {
    constructor (props) {
        super(props)
        this.state = {
            userName: ''
        };
        this.сreateUser = this.сreateUser.bind(this);
        this.loginUser = this.loginUser.bind(this);
    }

    loginUser(){

        console.log("LogIn");
        this.props.login(
            {
                email: this.refs.userEmail.value,
                pass: this.refs.password.value
            }
        );

    }

    componentDidMount () {
        this.props.fetchUsers();
    }
    сreateUser(){
        console.log(this.state.userName);
        this.props.createUser(
            {
                userName: this.refs.userName.value,
                email: this.refs.email.value,
                pass: this.refs.pass.value
            }
        );
        this.state = {
            userName: '',
            email: '',
            pass: ''
        };
        this.props.fetchUsers();
    }
    render () {
        let listItems = [];
        if(this.props.state.users.length  > 0){
            listItems = this.props.state.users.map((user) =>
                <li key={user._id}>
                    <span> id - {user._id}</span>
                    <span> role - {user.role}</span>
                    <span> email - {user.email}</span>
                    <span> name - {user.name}</span>
                    <span> pass - {user.pass}</span>
                </li>
            );
        }
        return (
            <main className='dashboard-page'>
                <div className='col-md-6' >
                    <h1>User - {this.state.userName || 'none'}</h1>

                        <label for="userName">UserName</label>
                        <br/>
                        <input ref="userName" className="input" type='text' />
                        <br/>
                        <label for="email">Email</label>
                        <br/>
                        <input ref="email" className="input" type='text' />
                        <br/>
                        <label for="pass">Password</label>
                        <br/>
                        <input ref="pass" className="input" type='text'  />
                        <button onClick={this.сreateUser} className="btn">Create new user</button>
                    <ul>
                        {listItems}
                    </ul>
                </div>
                <div className='col-md-6'>
                        <label for="email">Email</label>
                        <br/>
                        <input ref="userEmail" className="input" type='text'  />
                        <br/>
                        <label for="pass">Password</label>
                        <br/>
                        <input ref="password" className="input" type='text' />
                        <button onClick={this.loginUser} className="btn">Create new user</button>
                </div>

            </main>

        )
    }
}

const mapStateToProps = (state, ownProps) => {
    return {
        state: state,
        ownProps: ownProps
    }
};

const mapDispatchToProps = {
    fetchUsers,
    createUser,
    login

};

export default connect(mapStateToProps, mapDispatchToProps)(Dashboard)